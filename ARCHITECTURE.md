# Architecture Diagram

## ğŸ—ï¸ Application Layers (Top to Bottom)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ğŸ‘¤ USER                              â”‚
â”‚                    (Web Browser / API Client)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸŒ API LAYER                              â”‚
â”‚                  (app/api/routes/)                           â”‚
â”‚                                                              â”‚
â”‚  â€¢ Receives HTTP requests                                   â”‚
â”‚  â€¢ Validates input                                          â”‚
â”‚  â€¢ Returns HTTP responses                                   â”‚
â”‚  â€¢ Handles errors                                           â”‚
â”‚                                                              â”‚
â”‚  Files: health.py, decisions.py, graph.py                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   âš™ï¸ SERVICE LAYER                           â”‚
â”‚                  (app/services/)                             â”‚
â”‚                                                              â”‚
â”‚  â€¢ Orchestrates business operations                         â”‚
â”‚  â€¢ Manages process lifecycle                                â”‚
â”‚  â€¢ Coordinates multiple agents                              â”‚
â”‚  â€¢ Handles persistence                                      â”‚
â”‚                                                              â”‚
â”‚  Files: decision_service.py, process_manager.py             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ¤– CORE LAYER                             â”‚
â”‚               (app/core/agents/ & app/core/graph/)           â”‚
â”‚                                                              â”‚
â”‚  â€¢ AI Agents (decision-making logic)                        â”‚
â”‚  â€¢ Graph execution (workflow)                               â”‚
â”‚  â€¢ Business rules                                           â”‚
â”‚  â€¢ Domain logic                                             â”‚
â”‚                                                              â”‚
â”‚  Files: decision_agents.py, evaluator_agents.py, executor.pyâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ğŸ’¾ DATA LAYER                              â”‚
â”‚            (app/models/ & External Services)                 â”‚
â”‚                                                              â”‚
â”‚  â€¢ Data models                                              â”‚
â”‚  â€¢ Database (future)                                        â”‚
â”‚  â€¢ Cache (future)                                           â”‚
â”‚  â€¢ External APIs                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Request Flow Example

### Example: User wants to make a decision

```
1. USER
   â”‚
   â”‚ POST /decision/run
   â”‚ {"decision_query": "Should I invest in AI?"}
   â–¼
   
2. API LAYER (routes/decisions.py)
   â”‚
   â”‚ â€¢ Validates request
   â”‚ â€¢ Creates DecisionRequest model
   â–¼
   
3. SERVICE LAYER (decision_service.py)
   â”‚
   â”‚ â€¢ Creates DecisionState
   â”‚ â€¢ Calls process_manager
   â–¼
   
4. CORE LAYER (agents + graph)
   â”‚
   â”‚ â€¢ Execute graph nodes in order:
   â”‚   â””â”€ IdentifyTrigger
   â”‚   â””â”€ AnalyzeRootCause
   â”‚   â””â”€ ScopeDefinition
   â”‚   â””â”€ ... (10 more steps)
   â”‚   â””â”€ Result
   â”‚
   â–¼
   
5. SERVICE LAYER (decision_service.py)
   â”‚
   â”‚ â€¢ Formats result
   â”‚ â€¢ Saves to persistence
   â–¼
   
6. API LAYER (routes/decisions.py)
   â”‚
   â”‚ â€¢ Creates DecisionResponse model
   â”‚ â€¢ Returns JSON
   â–¼
   
7. USER
   â”‚
   â”‚ Receives:
   â”‚ {
   â”‚   "selected_decision": "Yes, invest...",
   â”‚   "alternative_decision": "Consider...",
   â”‚   ...
   â”‚ }
```

---

## ğŸ¯ Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DecisionRequest â”‚ â”€â”€â–º API receives
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DecisionState â”‚ â”€â”€â–º Passed through graph
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ResultOutput  â”‚ â”€â”€â–º Agents produce
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚DecisionResponseâ”‚ â”€â”€â–º API returns
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ›ï¸ Clean Architecture Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Presentation Layer             â”‚  â† API Routes
â”‚  (HTTP, WebSocket, CLI, etc.)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Application Layer               â”‚  â† Services
â”‚  (Use Cases, Orchestration)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Domain Layer                  â”‚  â† Core
â”‚  (Business Logic, Entities)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Infrastructure Layer             â”‚  â† Data Access
â”‚  (Database, External APIs, Files)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Key Rule: **Dependency Direction**
- Upper layers depend on lower layers
- Lower layers NEVER depend on upper layers
- Core has NO dependencies on API or Services

---

## ğŸ“¦ Module Dependencies

```
app/
â”œâ”€â”€ api/              (depends on â†“)
â”‚   â””â”€â”€ routes/       
â”‚       â”œâ”€â”€ health.py      â†’ config
â”‚       â”œâ”€â”€ decisions.py   â†’ services, models
â”‚       â””â”€â”€ graph.py       â†’ services, models
â”‚
â”œâ”€â”€ services/         (depends on â†“)
â”‚   â”œâ”€â”€ decision_service.py  â†’ core, models
â”‚   â””â”€â”€ process_manager.py   â†’ core, models
â”‚
â”œâ”€â”€ core/             (depends on â†“)
â”‚   â”œâ”€â”€ agents/       â†’ models, config
â”‚   â””â”€â”€ graph/        â†’ models, config
â”‚
â”œâ”€â”€ models/           (no dependencies!)
â”‚   â”œâ”€â”€ requests.py
â”‚   â”œâ”€â”€ responses.py
â”‚   â””â”€â”€ domain.py
â”‚
â”œâ”€â”€ utils/            (depends on â†“)
â”‚   â””â”€â”€ helpers.py    â†’ config
â”‚
â””â”€â”€ config.py         (no dependencies!)
```

---

## ğŸ”Œ Component Interaction

```
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Config  â”‚ â”€â”€â”€â”€â”€â”€â”
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
              â”‚             â”‚
              â–¼             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Models     â”‚  â”‚    Utils     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚             â”‚
              â–¼             â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚       Core           â”‚
         â”‚   (Agents + Graph)   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚     Services         â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚        API           â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¨ File Organization Pattern

### Before (Monolithic)
```
src/
â””â”€â”€ app.py  (300+ lines, everything mixed)
    â”œâ”€â”€ Imports
    â”œâ”€â”€ Models
    â”œâ”€â”€ Routes
    â”œâ”€â”€ Business Logic
    â””â”€â”€ Main function
```

### After (Modular)
```
backend/app/
â”œâ”€â”€ main.py                    (30 lines, just setup)
â”œâ”€â”€ config.py                  (100 lines, configuration)
â”‚
â”œâ”€â”€ models/                    (Data structures)
â”‚   â”œâ”€â”€ requests.py           (30 lines)
â”‚   â”œâ”€â”€ responses.py          (80 lines)
â”‚   â””â”€â”€ domain.py             (60 lines)
â”‚
â”œâ”€â”€ api/routes/                (HTTP handling)
â”‚   â”œâ”€â”€ health.py             (20 lines)
â”‚   â”œâ”€â”€ decisions.py          (100 lines)
â”‚   â””â”€â”€ graph.py              (30 lines)
â”‚
â”œâ”€â”€ services/                  (Orchestration)
â”‚   â”œâ”€â”€ decision_service.py   (150 lines)
â”‚   â””â”€â”€ process_manager.py    (100 lines)
â”‚
â””â”€â”€ core/                      (Business logic)
    â”œâ”€â”€ agents/
    â”‚   â”œâ”€â”€ decision_agents.py (200 lines)
    â”‚   â””â”€â”€ evaluator_agents.py (150 lines)
    â””â”€â”€ graph/
        â”œâ”€â”€ nodes.py          (300 lines)
        â””â”€â”€ executor.py       (100 lines)
```

**Result**: Same functionality, better organized!

---

## ğŸš€ Scalability Path

### Current (Phase 1)
```
Single API Server
```

### Phase 2 (Docker)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend â”‚â”€â”€â”€â”‚ Backend  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Phase 3 (Load Balanced)
```
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ Backend 1 â”‚
â”‚ Frontend â”‚â”€â”€â”€â”¤ Backend 2 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ Backend 3 â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Phase 4 (Microservices - Optional)
```
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ API Gateway â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼             â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Decision Svc â”‚ â”‚Agent Svc â”‚ â”‚ Graph Svcâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

This architecture supports growth from simple to complex without rewriting!
